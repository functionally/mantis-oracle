<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-2"></span><span class="hs-comment">--</span><span>
</span><span id="line-3"></span><span class="hs-comment">-- Module      :  $Headers</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- Copyright   :  (c) 2021 Brian W Bush</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- License     :  MIT</span><span>
</span><span id="line-6"></span><span class="hs-comment">--</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- Maintainer  :  Brian W Bush &lt;code@functionally.io&gt;</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- Stability   :  Experimental</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- Portability :  Portable</span><span>
</span><span id="line-10"></span><span class="hs-comment">--</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- | Example usage for the oracle.</span><span>
</span><span id="line-12"></span><span class="hs-comment">--</span><span>
</span><span id="line-13"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-pragma">{-# LANGUAGE DataKinds          #-}</span><span>
</span><span id="line-17"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts   #-}</span><span>
</span><span id="line-18"></span><span class="hs-pragma">{-# LANGUAGE NoImplicitPrelude  #-}</span><span>
</span><span id="line-19"></span><span class="hs-pragma">{-# LANGUAGE NumericUnderscores #-}</span><span>
</span><span id="line-20"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings  #-}</span><span>
</span><span id="line-21"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards    #-}</span><span>
</span><span id="line-22"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications   #-}</span><span>
</span><span id="line-23"></span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Mantis.Oracle.Simulate</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-26"></span><span class="annot"><span class="hs-comment">-- * Example</span></span><span>
</span><span id="line-27"></span><span>  </span><span class="annot"><a href="Mantis.Oracle.Simulate.html#main"><span class="hs-identifier">main</span></a></span><span>
</span><span id="line-28"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusTx.Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(&lt;&gt;)</span></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">void</span></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Default</span></span><span>             </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">def</span></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Monoid</span></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Last</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Ada</span></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fromValue</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">getLovelace</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">lovelaceValueOf</span></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Address</span></span><span>           </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">pubKeyAddress</span></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Tx</span></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">txOutTxOut</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">txOutValue</span></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Value</span></span><span>             </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">AssetClass</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">CurrencySymbol</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TokenName</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Value</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">assetClass</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">assetClassValueOf</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">flattenValue</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">toString</span></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Mantis.Oracle.html"><span class="hs-identifier">Mantis.Oracle</span></a></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="Mantis.Oracle.html#findOracle"><span class="hs-identifier">findOracle</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Mantis.Oracle.html#oracleAddress"><span class="hs-identifier">oracleAddress</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Mantis.Oracle.Client.html"><span class="hs-identifier">Mantis.Oracle.Client</span></a></span><span>     </span><span class="hs-special">(</span><span class="annot"><a href="Mantis.Oracle.Client.html#runOracleClient"><span class="hs-identifier">runOracleClient</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Mantis.Oracle.Controller.html"><span class="hs-identifier">Mantis.Oracle.Controller</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Mantis.Oracle.Controller.html#runOracleController"><span class="hs-identifier">runOracleController</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Mantis.Oracle.Types.html"><span class="hs-identifier">Mantis.Oracle.Types</span></a></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Mantis.Oracle.Types.html#Oracle"><span class="hs-identifier">Oracle</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Mantis.Oracle.Types.html#Parameters"><span class="hs-identifier">Parameters</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">IO</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">String</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(&lt;&gt;)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">div</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">show</span></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusTx</span></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Data</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">I</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Wallet.Emulator.Wallet</span></span><span>   </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Wallet</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Freer.Extras</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">X</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">logInfo</span></span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span>                   </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">elems</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">fromList</span></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Value</span></span><span>               </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">singleton</span></span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Plutus.Contract</span></span><span>            </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">BlockchainActions</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Contract</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">handleError</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">logError</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">logInfo</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ownPubKey</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">tell</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">utxoAt</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">waitNSlots</span></span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Plutus.Trace.Emulator</span></span><span>      </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">E</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">EmulatorConfig</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">EmulatorTrace</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">activateContractWallet</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">callEndpoint</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">observableState</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">runEmulatorTraceIO'</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">waitNSlots</span></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span class="hs-comment">-- | Run the example.</span><span>
</span><span id="line-57"></span><span class="annot"><a href="Mantis.Oracle.Simulate.html#main"><span class="hs-identifier hs-type">main</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CurrencySymbol</span></span><span> </span><span class="hs-comment">-- ^ Currency symbol for the example tokens.</span><span>
</span><span id="line-58"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TokenName</span></span><span>      </span><span class="hs-comment">-- ^ Name of the control token.</span><span>
</span><span id="line-59"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TokenName</span></span><span>      </span><span class="hs-comment">-- ^ Name of the datum token.</span><span>
</span><span id="line-60"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TokenName</span></span><span>      </span><span class="hs-comment">-- ^ Name of the fee token.</span><span>
</span><span id="line-61"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span>        </span><span class="hs-comment">-- ^ Amount of fee token needed to read the oracle.</span><span>
</span><span id="line-62"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Action for running the example.</span><span>
</span><span id="line-63"></span><span id="main"><span class="annot"><span class="annottext">main :: CurrencySymbol
-&gt; TokenName -&gt; TokenName -&gt; TokenName -&gt; Integer -&gt; IO ()
</span><a href="Mantis.Oracle.Simulate.html#main"><span class="hs-identifier hs-var hs-var">main</span></a></span></span><span> </span><span id="local-6989586621679284452"><span class="annot"><span class="annottext">CurrencySymbol
</span><a href="#local-6989586621679284452"><span class="hs-identifier hs-var">symbol</span></a></span></span><span> </span><span id="local-6989586621679284451"><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621679284451"><span class="hs-identifier hs-var">controlName</span></a></span></span><span> </span><span id="local-6989586621679284450"><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621679284450"><span class="hs-identifier hs-var">datumName</span></a></span></span><span> </span><span id="local-6989586621679284449"><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621679284449"><span class="hs-identifier hs-var">feeName</span></a></span></span><span> </span><span id="local-6989586621679284448"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679284448"><span class="hs-identifier hs-var">feeAmount</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span>    </span><span id="local-6989586621679284447"><span class="annot"><span class="annottext">controlParameter :: AssetClass
</span><a href="#local-6989586621679284447"><span class="hs-identifier hs-var hs-var">controlParameter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CurrencySymbol, TokenName) -&gt; AssetClass
</span><span class="hs-identifier hs-var">AssetClass</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CurrencySymbol
</span><a href="#local-6989586621679284452"><span class="hs-identifier hs-var">symbol</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621679284451"><span class="hs-identifier hs-var">controlName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span>    </span><span id="local-6989586621679284445"><span class="annot"><span class="annottext">datumParameter :: AssetClass
</span><a href="#local-6989586621679284445"><span class="hs-identifier hs-var hs-var">datumParameter</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CurrencySymbol, TokenName) -&gt; AssetClass
</span><span class="hs-identifier hs-var">AssetClass</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CurrencySymbol
</span><a href="#local-6989586621679284452"><span class="hs-identifier hs-var">symbol</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621679284450"><span class="hs-identifier hs-var">datumName</span></a></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span>    </span><span id="local-6989586621679284444"><span class="annot"><span class="annottext">feeToken :: AssetClass
</span><a href="#local-6989586621679284444"><span class="hs-identifier hs-var hs-var">feeToken</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CurrencySymbol, TokenName) -&gt; AssetClass
</span><span class="hs-identifier hs-var">AssetClass</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CurrencySymbol
</span><a href="#local-6989586621679284452"><span class="hs-identifier hs-var">symbol</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621679284449"><span class="hs-identifier hs-var">feeName</span></a></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span>   </span><span>
</span><span id="line-71"></span><span>    </span><span id="local-6989586621679284443"><span class="annot"><span class="annottext">initial :: Value
</span><a href="#local-6989586621679284443"><span class="hs-identifier hs-var hs-var">initial</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Value
</span><span class="hs-identifier hs-var">lovelaceValueOf</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">100_000_000</span></span><span>
</span><span id="line-72"></span><span>    </span><span id="local-6989586621679284442"><span class="annot"><span class="annottext">withValue :: TokenName -&gt; Integer -&gt; Value
</span><a href="#local-6989586621679284442"><span class="hs-identifier hs-var hs-var">withValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CurrencySymbol -&gt; TokenName -&gt; Integer -&gt; Value
</span><span class="hs-identifier hs-var">V.singleton</span></span><span> </span><span class="annot"><span class="annottext">CurrencySymbol
</span><a href="#local-6989586621679284452"><span class="hs-identifier hs-var">symbol</span></a></span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span>    </span><span id="local-6989586621679284441"><span class="annot"><span class="annottext">config :: EmulatorConfig
</span><a href="#local-6989586621679284441"><span class="hs-identifier hs-var hs-var">config</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-75"></span><span>      </span><span class="annot"><span class="annottext">InitialChainState -&gt; EmulatorConfig
</span><span class="hs-identifier hs-var">E.EmulatorConfig</span></span><span>
</span><span id="line-76"></span><span>        </span><span class="annot"><span class="annottext">(InitialChainState -&gt; EmulatorConfig)
-&gt; (InitialDistribution -&gt; InitialChainState)
-&gt; InitialDistribution
-&gt; EmulatorConfig
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">InitialDistribution -&gt; InitialChainState
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span>
</span><span id="line-77"></span><span>        </span><span class="annot"><span class="annottext">(InitialDistribution -&gt; EmulatorConfig)
-&gt; InitialDistribution -&gt; EmulatorConfig
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>  </span><span class="annot"><span class="annottext">[(Wallet, Value)] -&gt; InitialDistribution
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">M.fromList</span></span><span>
</span><span id="line-78"></span><span>        </span><span class="hs-special">[</span><span>
</span><span id="line-79"></span><span>          </span><span class="hs-comment">-- Wallet 1 controls the oracle.</span><span>
</span><span id="line-80"></span><span>          </span><span class="hs-special">(</span><span>
</span><span id="line-81"></span><span>            </span><span class="annot"><span class="annottext">Integer -&gt; Wallet
</span><span class="hs-identifier hs-var">Wallet</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span>
</span><span id="line-82"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679284443"><span class="hs-identifier hs-var">initial</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Value
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621679284451"><span class="hs-identifier hs-var">controlName</span></a></span><span> </span><span class="annot"><span class="annottext">TokenName -&gt; Integer -&gt; Value
</span><a href="#local-6989586621679284442"><span class="hs-operator hs-var">`withValue`</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Value
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621679284450"><span class="hs-identifier hs-var">datumName</span></a></span><span> </span><span class="annot"><span class="annottext">TokenName -&gt; Integer -&gt; Value
</span><a href="#local-6989586621679284442"><span class="hs-operator hs-var">`withValue`</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span>
</span><span id="line-83"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-85"></span><span>          </span><span class="hs-comment">-- Wallet 2 has enough of the fee token to read the oracle twice.</span><span>
</span><span id="line-86"></span><span>            </span><span class="annot"><span class="annottext">Integer -&gt; Wallet
</span><span class="hs-identifier hs-var">Wallet</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">2</span></span><span>
</span><span id="line-87"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679284443"><span class="hs-identifier hs-var">initial</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Value
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621679284449"><span class="hs-identifier hs-var">feeName</span></a></span><span> </span><span class="annot"><span class="annottext">TokenName -&gt; Integer -&gt; Value
</span><a href="#local-6989586621679284442"><span class="hs-operator hs-var">`withValue`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679284448"><span class="hs-identifier hs-var">feeAmount</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. MultiplicativeSemigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-90"></span><span>            </span><span class="hs-comment">-- Wallet 3 doesn't not have have enough fee tokens to read the oracle at all.</span><span>
</span><span id="line-91"></span><span>            </span><span class="annot"><span class="annottext">Integer -&gt; Wallet
</span><span class="hs-identifier hs-var">Wallet</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">3</span></span><span>
</span><span id="line-92"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679284443"><span class="hs-identifier hs-var">initial</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Value
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621679284449"><span class="hs-identifier hs-var">feeName</span></a></span><span> </span><span class="annot"><span class="annottext">TokenName -&gt; Integer -&gt; Value
</span><a href="#local-6989586621679284442"><span class="hs-operator hs-var">`withValue`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679284448"><span class="hs-identifier hs-var">feeAmount</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`div`</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-95"></span><span>            </span><span class="hs-comment">-- Wallet 4 just monitors transactions of the oracle.</span><span>
</span><span id="line-96"></span><span>            </span><span class="annot"><span class="annottext">Integer -&gt; Wallet
</span><span class="hs-identifier hs-var">Wallet</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">4</span></span><span>
</span><span id="line-97"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679284443"><span class="hs-identifier hs-var">initial</span></a></span><span>
</span><span id="line-98"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span>  </span><span class="hs-keyword">in</span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span>    </span><span class="annot"><span class="annottext">TraceConfig -&gt; EmulatorConfig -&gt; EmulatorTrace () -&gt; IO ()
</span><span class="hs-identifier hs-var">E.runEmulatorTraceIO'</span></span><span> </span><span class="annot"><span class="annottext">TraceConfig
forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span> </span><span class="annot"><span class="annottext">EmulatorConfig
</span><a href="#local-6989586621679284441"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-104"></span><span>      </span><span class="annot"><span class="annottext">(EmulatorTrace () -&gt; IO ()) -&gt; EmulatorTrace () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Parameters -&gt; EmulatorTrace ()
</span><a href="Mantis.Oracle.Simulate.html#testTrace"><span class="hs-identifier hs-var">testTrace</span></a></span><span> </span><span class="annot"><span class="annottext">Parameters :: AssetClass -&gt; AssetClass -&gt; AssetClass -&gt; Integer -&gt; Parameters
</span><a href="Mantis.Oracle.Types.html#Parameters"><span class="hs-identifier hs-type">Parameters</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">Integer
AssetClass
feeAmount :: Integer
feeToken :: AssetClass
datumParameter :: AssetClass
controlParameter :: AssetClass
feeToken :: AssetClass
datumParameter :: AssetClass
controlParameter :: AssetClass
feeAmount :: Integer
</span><a href="Mantis.Oracle.Types.html#feeAmount"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span class="hs-comment">-- | Trace the oracles operation for a given set of parameters.</span><span>
</span><span id="line-108"></span><span class="annot"><a href="Mantis.Oracle.Simulate.html#testTrace"><span class="hs-identifier hs-type">testTrace</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Mantis.Oracle.Types.html#Parameters"><span class="hs-identifier hs-type">Parameters</span></a></span><span>         </span><span class="hs-comment">-- ^ The parameters for the oracle.</span><span>
</span><span id="line-109"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">E.EmulatorTrace</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ The action for running the test.</span><span>
</span><span id="line-110"></span><span id="testTrace"><span class="annot"><span class="annottext">testTrace :: Parameters -&gt; EmulatorTrace ()
</span><a href="Mantis.Oracle.Simulate.html#testTrace"><span class="hs-identifier hs-var hs-var">testTrace</span></a></span></span><span> </span><span id="local-6989586621679284429"><span class="annot"><span class="annottext">Parameters
</span><a href="#local-6989586621679284429"><span class="hs-identifier hs-var">parameters</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-111"></span><span>  </span><span class="hs-keyword">do</span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-114"></span><span>      </span><span id="local-6989586621679284428"><span class="annot"><span class="annottext">getOracle :: ContractHandle (Last b) s e -&gt; Eff effs b
</span><a href="#local-6989586621679284428"><span class="hs-identifier hs-var hs-var">getOracle</span></a></span></span><span> </span><span id="local-6989586621679284427"><span class="annot"><span class="annottext">ContractHandle (Last b) s e
</span><a href="#local-6989586621679284427"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-115"></span><span>        </span><span class="hs-keyword">do</span><span>
</span><span id="line-116"></span><span>          </span><span id="local-6989586621679284426"><span class="annot"><span class="annottext">Last b
</span><a href="#local-6989586621679284426"><span class="hs-identifier hs-var">last</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ContractHandle (Last b) s e -&gt; Eff effs (Last b)
forall w (s :: Row *) e (effs :: [* -&gt; *]).
(Member RunContract effs, ContractConstraints s, FromJSON e,
 FromJSON w) =&gt;
ContractHandle w s e -&gt; Eff effs w
</span><span class="hs-identifier hs-var">E.observableState</span></span><span> </span><span class="annot"><span class="annottext">ContractHandle (Last b) s e
</span><a href="#local-6989586621679284427"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-117"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Last b
</span><a href="#local-6989586621679284426"><span class="hs-identifier hs-var">last</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-118"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Last</span></span><span> </span><span class="annot"><span class="annottext">Maybe b
</span><span class="hs-identifier hs-var">Nothing</span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Eff effs Slot
forall (effs :: [* -&gt; *]).
Member Waiting effs =&gt;
Natural -&gt; Eff effs Slot
</span><span class="hs-identifier hs-var">E.waitNSlots</span></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">1</span></span><span>          </span><span class="annot"><span class="annottext">Eff effs Slot -&gt; Eff effs b -&gt; Eff effs b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ContractHandle (Last b) s e -&gt; Eff effs b
</span><a href="#local-6989586621679284428"><span class="hs-identifier hs-var">getOracle</span></a></span><span> </span><span class="annot"><span class="annottext">ContractHandle (Last b) s e
</span><a href="#local-6989586621679284427"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-119"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Last</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679284424"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679284424"><span class="hs-identifier hs-var">oracle</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Eff effs ()
forall a (effs :: [* -&gt; *]).
Member (LogMsg a) effs =&gt;
a -&gt; Eff effs ()
</span><span class="hs-identifier hs-var">X.logInfo</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679284424"><span class="hs-identifier hs-var">oracle</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Eff effs () -&gt; Eff effs b -&gt; Eff effs b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">b -&gt; Eff effs b
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679284424"><span class="hs-identifier hs-var">oracle</span></a></span><span>
</span><span id="line-120"></span><span>
</span><span id="line-121"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; EmulatorTrace ()
forall a (effs :: [* -&gt; *]).
Member (LogMsg a) effs =&gt;
a -&gt; Eff effs ()
</span><span class="hs-identifier hs-var">X.logInfo</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Wallet 1 starts the oracle, but does not set its value yet.&quot;</span></span><span>
</span><span id="line-122"></span><span>    </span><span id="local-6989586621679284423"><span class="annot"><span class="annottext">ContractHandle
  (Last Oracle)
  ('R
     '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
        &quot;delete&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
        &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
        &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
        &quot;read&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
        &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
        &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
        &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address),
        &quot;write&quot; ':-&gt; (EndpointValue Data, ActiveEndpoint)])
  Text
</span><a href="#local-6989586621679284423"><span class="hs-identifier hs-var">w1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Wallet
-&gt; Contract
     (Last Oracle)
     ('R
        '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
           &quot;delete&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
           &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
           &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
           &quot;read&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
           &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
           &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
           &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address),
           &quot;write&quot; ':-&gt; (EndpointValue Data, ActiveEndpoint)])
     Text
     ()
-&gt; Eff
     '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
       LogMsg String, Error EmulatorRuntimeError]
     (ContractHandle
        (Last Oracle)
        ('R
           '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
              &quot;delete&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
              &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
              &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
              &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
              &quot;read&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
              &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
              &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
              &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
              &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address),
              &quot;write&quot; ':-&gt; (EndpointValue Data, ActiveEndpoint)])
        Text)
forall w (s :: Row *) e (effs :: [* -&gt; *]).
(HasBlockchainActions s, ContractConstraints s, Show e, ToJSON e,
 FromJSON e, ToJSON w, Member RunContract effs, Monoid w) =&gt;
Wallet -&gt; Contract w s e () -&gt; Eff effs (ContractHandle w s e)
</span><span class="hs-identifier hs-var">E.activateContractWallet</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Wallet
</span><span class="hs-identifier hs-var">Wallet</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-123"></span><span>       </span><span class="annot"><span class="annottext">(Contract
   (Last Oracle)
   ('R
      '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
         &quot;delete&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
         &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
         &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
         &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
         &quot;read&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
         &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
         &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
         &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
         &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address),
         &quot;write&quot; ':-&gt; (EndpointValue Data, ActiveEndpoint)])
   Text
   ()
 -&gt; Eff
      '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
        LogMsg String, Error EmulatorRuntimeError]
      (ContractHandle
         (Last Oracle)
         ('R
            '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
               &quot;delete&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
               &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
               &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
               &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
               &quot;read&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
               &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
               &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
               &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
               &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address),
               &quot;write&quot; ':-&gt; (EndpointValue Data, ActiveEndpoint)])
         Text))
-&gt; Contract
     (Last Oracle)
     ('R
        '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
           &quot;delete&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
           &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
           &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
           &quot;read&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
           &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
           &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
           &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address),
           &quot;write&quot; ':-&gt; (EndpointValue Data, ActiveEndpoint)])
     Text
     ()
-&gt; Eff
     '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
       LogMsg String, Error EmulatorRuntimeError]
     (ContractHandle
        (Last Oracle)
        ('R
           '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
              &quot;delete&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
              &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
              &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
              &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
              &quot;read&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
              &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
              &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
              &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
              &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address),
              &quot;write&quot; ':-&gt; (EndpointValue Data, ActiveEndpoint)])
        Text)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>  </span><span class="annot"><span class="annottext">Parameters -&gt; Contract (Last Oracle) OracleSchema Text ()
</span><a href="Mantis.Oracle.Controller.html#runOracleController"><span class="hs-identifier hs-var">runOracleController</span></a></span><span> </span><span class="annot"><span class="annottext">Parameters
</span><a href="#local-6989586621679284429"><span class="hs-identifier hs-var">parameters</span></a></span><span>
</span><span id="line-124"></span><span>    </span><span class="annot"><span class="annottext">Eff
  '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
    LogMsg String, Error EmulatorRuntimeError]
  Slot
-&gt; EmulatorTrace ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(Eff
   '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
     LogMsg String, Error EmulatorRuntimeError]
   Slot
 -&gt; EmulatorTrace ())
-&gt; Eff
     '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
       LogMsg String, Error EmulatorRuntimeError]
     Slot
-&gt; EmulatorTrace ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Natural
-&gt; Eff
     '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
       LogMsg String, Error EmulatorRuntimeError]
     Slot
forall (effs :: [* -&gt; *]).
Member Waiting effs =&gt;
Natural -&gt; Eff effs Slot
</span><span class="hs-identifier hs-var">E.waitNSlots</span></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">1</span></span><span>
</span><span id="line-125"></span><span>    </span><span id="local-6989586621679284422"><span class="annot"><span class="annottext">Oracle
</span><a href="#local-6989586621679284422"><span class="hs-identifier hs-var">oracle</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ContractHandle
  (Last Oracle)
  ('R
     '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
        &quot;delete&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
        &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
        &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
        &quot;read&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
        &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
        &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
        &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address),
        &quot;write&quot; ':-&gt; (EndpointValue Data, ActiveEndpoint)])
  Text
-&gt; Eff
     '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
       LogMsg String, Error EmulatorRuntimeError]
     Oracle
forall (s :: Row *) e b (effs :: [* -&gt; *]).
(AllUniqueLabels (Input s), AllUniqueLabels (Output s),
 Forall (Input s) Unconstrained1, Forall (Input s) FromJSON,
 Forall (Input s) ToJSON, Forall (Output s) Unconstrained1,
 Forall (Output s) FromJSON, Forall (Output s) ToJSON, FromJSON e,
 FromJSON b, FindElem (LogMsg String) effs,
 FindElem RunContract effs, FindElem Waiting effs, Show b) =&gt;
ContractHandle (Last b) s e -&gt; Eff effs b
</span><a href="#local-6989586621679284428"><span class="hs-identifier hs-var">getOracle</span></a></span><span> </span><span class="annot"><span class="annottext">ContractHandle
  (Last Oracle)
  ('R
     '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
        &quot;delete&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
        &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
        &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
        &quot;read&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
        &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
        &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
        &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address),
        &quot;write&quot; ':-&gt; (EndpointValue Data, ActiveEndpoint)])
  Text
</span><a href="#local-6989586621679284423"><span class="hs-identifier hs-var">w1</span></a></span><span>
</span><span id="line-126"></span><span>
</span><span id="line-127"></span><span>    </span><span class="annot"><span class="annottext">[Eff
   '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
     LogMsg String, Error EmulatorRuntimeError]
   (ContractHandle
      (Last Value)
      ('R
         '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
            &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
            &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
            &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
            &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
            &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
            &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
            &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
      Text)]
-&gt; EmulatorTrace ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Foldable t, Monad m) =&gt;
t (m a) -&gt; m ()
</span><span class="hs-identifier hs-var">sequence_</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Wallet
-&gt; Contract
     (Last Value)
     ('R
        '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
           &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
           &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
           &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
           &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
           &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
           &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
           &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
     Text
     ()
-&gt; Eff
     '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
       LogMsg String, Error EmulatorRuntimeError]
     (ContractHandle
        (Last Value)
        ('R
           '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
              &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
              &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
              &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
              &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
              &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
              &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
              &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
        Text)
forall w (s :: Row *) e (effs :: [* -&gt; *]).
(HasBlockchainActions s, ContractConstraints s, Show e, ToJSON e,
 FromJSON e, ToJSON w, Member RunContract effs, Monoid w) =&gt;
Wallet -&gt; Contract w s e () -&gt; Eff effs (ContractHandle w s e)
</span><span class="hs-identifier hs-var">E.activateContractWallet</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Wallet
</span><span class="hs-identifier hs-var">Wallet</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679284420"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Contract
   (Last Value)
   ('R
      '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
         &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
         &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
         &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
         &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
         &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
         &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
         &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
   Text
   ()
 -&gt; Eff
      '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
        LogMsg String, Error EmulatorRuntimeError]
      (ContractHandle
         (Last Value)
         ('R
            '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
               &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
               &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
               &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
               &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
               &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
               &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
               &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
         Text))
-&gt; (Maybe Integer
    -&gt; Contract
         (Last Value)
         ('R
            '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
               &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
               &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
               &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
               &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
               &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
               &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
               &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
         Text
         ())
-&gt; Maybe Integer
-&gt; Eff
     '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
       LogMsg String, Error EmulatorRuntimeError]
     (ContractHandle
        (Last Value)
        ('R
           '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
              &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
              &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
              &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
              &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
              &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
              &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
              &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
        Text)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Oracle
-&gt; Maybe Integer -&gt; Contract (Last Value) BlockchainActions Text ()
</span><a href="Mantis.Oracle.Simulate.html#peekFunds"><span class="hs-identifier hs-var">peekFunds</span></a></span><span> </span><span class="annot"><span class="annottext">Oracle
</span><a href="#local-6989586621679284422"><span class="hs-identifier hs-var">oracle</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Integer
 -&gt; Eff
      '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
        LogMsg String, Error EmulatorRuntimeError]
      (ContractHandle
         (Last Value)
         ('R
            '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
               &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
               &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
               &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
               &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
               &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
               &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
               &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
         Text))
-&gt; Maybe Integer
-&gt; Eff
     '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
       LogMsg String, Error EmulatorRuntimeError]
     (ContractHandle
        (Last Value)
        ('R
           '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
              &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
              &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
              &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
              &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
              &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
              &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
              &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
        Text)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Maybe Integer
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679284420"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679284420"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679284420"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-glyph">..</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">4</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-128"></span><span>    </span><span class="annot"><span class="annottext">Eff
  '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
    LogMsg String, Error EmulatorRuntimeError]
  (ContractHandle
     (Last Value)
     ('R
        '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
           &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
           &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
           &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
           &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
           &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
           &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
           &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
     Text)
-&gt; EmulatorTrace ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(Eff
   '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
     LogMsg String, Error EmulatorRuntimeError]
   (ContractHandle
      (Last Value)
      ('R
         '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
            &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
            &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
            &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
            &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
            &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
            &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
            &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
      Text)
 -&gt; EmulatorTrace ())
-&gt; (Contract
      (Last Value)
      ('R
         '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
            &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
            &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
            &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
            &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
            &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
            &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
            &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
      Text
      ()
    -&gt; Eff
         '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
           LogMsg String, Error EmulatorRuntimeError]
         (ContractHandle
            (Last Value)
            ('R
               '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
                  &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
                  &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
                  &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
                  &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
                  &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
                  &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
                  &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
            Text))
-&gt; Contract
     (Last Value)
     ('R
        '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
           &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
           &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
           &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
           &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
           &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
           &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
           &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
     Text
     ()
-&gt; EmulatorTrace ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Wallet
-&gt; Contract
     (Last Value)
     ('R
        '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
           &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
           &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
           &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
           &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
           &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
           &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
           &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
     Text
     ()
-&gt; Eff
     '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
       LogMsg String, Error EmulatorRuntimeError]
     (ContractHandle
        (Last Value)
        ('R
           '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
              &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
              &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
              &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
              &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
              &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
              &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
              &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
        Text)
forall w (s :: Row *) e (effs :: [* -&gt; *]).
(HasBlockchainActions s, ContractConstraints s, Show e, ToJSON e,
 FromJSON e, ToJSON w, Member RunContract effs, Monoid w) =&gt;
Wallet -&gt; Contract w s e () -&gt; Eff effs (ContractHandle w s e)
</span><span class="hs-identifier hs-var">E.activateContractWallet</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Wallet
</span><span class="hs-identifier hs-var">Wallet</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Contract
   (Last Value)
   ('R
      '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
         &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
         &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
         &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
         &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
         &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
         &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
         &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
   Text
   ()
 -&gt; EmulatorTrace ())
-&gt; Contract
     (Last Value)
     ('R
        '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
           &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
           &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
           &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
           &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
           &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
           &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
           &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
     Text
     ()
-&gt; EmulatorTrace ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Oracle
-&gt; Maybe Integer -&gt; Contract (Last Value) BlockchainActions Text ()
</span><a href="Mantis.Oracle.Simulate.html#peekFunds"><span class="hs-identifier hs-var">peekFunds</span></a></span><span> </span><span class="annot"><span class="annottext">Oracle
</span><a href="#local-6989586621679284422"><span class="hs-identifier hs-var">oracle</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Integer
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-129"></span><span>
</span><span id="line-130"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; EmulatorTrace ()
forall a (effs :: [* -&gt; *]).
Member (LogMsg a) effs =&gt;
a -&gt; Eff effs ()
</span><span class="hs-identifier hs-var">X.logInfo</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Wallet 4 just watches transactions of the oracle.&quot;</span></span><span>
</span><span id="line-131"></span><span>    </span><span class="annot"><span class="annottext">Eff
  '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
    LogMsg String, Error EmulatorRuntimeError]
  (ContractHandle
     ()
     ('R
        '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
           &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
           &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
           &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
           &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
           &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
           &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
           &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
     Text)
-&gt; EmulatorTrace ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(Eff
   '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
     LogMsg String, Error EmulatorRuntimeError]
   (ContractHandle
      ()
      ('R
         '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
            &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
            &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
            &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
            &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
            &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
            &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
            &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
      Text)
 -&gt; EmulatorTrace ())
-&gt; (Contract
      ()
      ('R
         '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
            &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
            &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
            &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
            &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
            &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
            &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
            &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
      Text
      ()
    -&gt; Eff
         '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
           LogMsg String, Error EmulatorRuntimeError]
         (ContractHandle
            ()
            ('R
               '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
                  &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
                  &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
                  &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
                  &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
                  &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
                  &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
                  &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
            Text))
-&gt; Contract
     ()
     ('R
        '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
           &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
           &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
           &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
           &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
           &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
           &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
           &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
     Text
     ()
-&gt; EmulatorTrace ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Wallet
-&gt; Contract
     ()
     ('R
        '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
           &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
           &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
           &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
           &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
           &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
           &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
           &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
     Text
     ()
-&gt; Eff
     '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
       LogMsg String, Error EmulatorRuntimeError]
     (ContractHandle
        ()
        ('R
           '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
              &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
              &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
              &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
              &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
              &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
              &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
              &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
        Text)
forall w (s :: Row *) e (effs :: [* -&gt; *]).
(HasBlockchainActions s, ContractConstraints s, Show e, ToJSON e,
 FromJSON e, ToJSON w, Member RunContract effs, Monoid w) =&gt;
Wallet -&gt; Contract w s e () -&gt; Eff effs (ContractHandle w s e)
</span><span class="hs-identifier hs-var">E.activateContractWallet</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Wallet
</span><span class="hs-identifier hs-var">Wallet</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">4</span></span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span>         </span><span class="annot"><span class="annottext">(Contract
   ()
   ('R
      '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
         &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
         &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
         &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
         &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
         &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
         &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
         &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
   Text
   ()
 -&gt; EmulatorTrace ())
-&gt; Contract
     ()
     ('R
        '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
           &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
           &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
           &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
           &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
           &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
           &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
           &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
     Text
     ()
-&gt; EmulatorTrace ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Oracle -&gt; Contract () BlockchainActions Text ()
</span><a href="Mantis.Oracle.Simulate.html#peekDatum"><span class="hs-identifier hs-var">peekDatum</span></a></span><span> </span><span class="annot"><span class="annottext">Oracle
</span><a href="#local-6989586621679284422"><span class="hs-identifier hs-var">oracle</span></a></span><span>
</span><span id="line-133"></span><span>    </span><span class="annot"><span class="annottext">Eff
  '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
    LogMsg String, Error EmulatorRuntimeError]
  Slot
-&gt; EmulatorTrace ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(Eff
   '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
     LogMsg String, Error EmulatorRuntimeError]
   Slot
 -&gt; EmulatorTrace ())
-&gt; Eff
     '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
       LogMsg String, Error EmulatorRuntimeError]
     Slot
-&gt; EmulatorTrace ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Natural
-&gt; Eff
     '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
       LogMsg String, Error EmulatorRuntimeError]
     Slot
forall (effs :: [* -&gt; *]).
Member Waiting effs =&gt;
Natural -&gt; Eff effs Slot
</span><span class="hs-identifier hs-var">E.waitNSlots</span></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">3</span></span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; EmulatorTrace ()
forall a (effs :: [* -&gt; *]).
Member (LogMsg a) effs =&gt;
a -&gt; Eff effs ()
</span><span class="hs-identifier hs-var">X.logInfo</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Wallet 2 has sufficient fee token to read the oracle twice.&quot;</span></span><span>
</span><span id="line-136"></span><span>    </span><span id="local-6989586621679284417"><span class="annot"><span class="annottext">ContractHandle
  (Last Value)
  ('R
     '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
        &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
        &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
        &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
        &quot;read&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
        &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
        &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
        &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
  Text
</span><a href="#local-6989586621679284417"><span class="hs-identifier hs-var">w2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Wallet
-&gt; Contract
     (Last Value)
     ('R
        '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
           &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
           &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
           &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
           &quot;read&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
           &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
           &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
           &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
     Text
     ()
-&gt; Eff
     '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
       LogMsg String, Error EmulatorRuntimeError]
     (ContractHandle
        (Last Value)
        ('R
           '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
              &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
              &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
              &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
              &quot;read&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
              &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
              &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
              &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
              &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
        Text)
forall w (s :: Row *) e (effs :: [* -&gt; *]).
(HasBlockchainActions s, ContractConstraints s, Show e, ToJSON e,
 FromJSON e, ToJSON w, Member RunContract effs, Monoid w) =&gt;
Wallet -&gt; Contract w s e () -&gt; Eff effs (ContractHandle w s e)
</span><span class="hs-identifier hs-var">E.activateContractWallet</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Wallet
</span><span class="hs-identifier hs-var">Wallet</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span>
</span><span id="line-137"></span><span>       </span><span class="annot"><span class="annottext">(Contract
   (Last Value)
   ('R
      '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
         &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
         &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
         &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
         &quot;read&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
         &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
         &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
         &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
         &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
   Text
   ()
 -&gt; Eff
      '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
        LogMsg String, Error EmulatorRuntimeError]
      (ContractHandle
         (Last Value)
         ('R
            '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
               &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
               &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
               &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
               &quot;read&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
               &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
               &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
               &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
               &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
         Text))
-&gt; Contract
     (Last Value)
     ('R
        '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
           &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
           &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
           &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
           &quot;read&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
           &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
           &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
           &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
     Text
     ()
-&gt; Eff
     '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
       LogMsg String, Error EmulatorRuntimeError]
     (ContractHandle
        (Last Value)
        ('R
           '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
              &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
              &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
              &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
              &quot;read&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
              &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
              &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
              &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
              &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
        Text)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>  </span><span class="annot"><span class="annottext">Oracle -&gt; Contract (Last Value) ClientSchema Text ()
</span><a href="Mantis.Oracle.Client.html#runOracleClient"><span class="hs-identifier hs-var">runOracleClient</span></a></span><span> </span><span class="annot"><span class="annottext">Oracle
</span><a href="#local-6989586621679284422"><span class="hs-identifier hs-var">oracle</span></a></span><span>
</span><span id="line-138"></span><span>    </span><span class="annot"><span class="annottext">Eff
  '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
    LogMsg String, Error EmulatorRuntimeError]
  Slot
-&gt; EmulatorTrace ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(Eff
   '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
     LogMsg String, Error EmulatorRuntimeError]
   Slot
 -&gt; EmulatorTrace ())
-&gt; Eff
     '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
       LogMsg String, Error EmulatorRuntimeError]
     Slot
-&gt; EmulatorTrace ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Natural
-&gt; Eff
     '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
       LogMsg String, Error EmulatorRuntimeError]
     Slot
forall (effs :: [* -&gt; *]).
Member Waiting effs =&gt;
Natural -&gt; Eff effs Slot
</span><span class="hs-identifier hs-var">E.waitNSlots</span></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">3</span></span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; EmulatorTrace ()
forall a (effs :: [* -&gt; *]).
Member (LogMsg a) effs =&gt;
a -&gt; Eff effs ()
</span><span class="hs-identifier hs-var">X.logInfo</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Wallet 2 tries to read the oracle before it holds data.&quot;</span></span><span>
</span><span id="line-141"></span><span>    </span><span class="annot"><span class="annottext">ContractHandle
  (Last Value)
  ('R
     '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
        &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
        &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
        &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
        &quot;read&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
        &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
        &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
        &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
  Text
-&gt; () -&gt; EmulatorTrace ()
forall (l :: Symbol) ep w (s :: Row *) e (effs :: [* -&gt; *]).
(ContractConstraints s, HasEndpoint l ep s,
 Member RunContract effs) =&gt;
ContractHandle w s e -&gt; ep -&gt; Eff effs ()
</span><span class="hs-identifier hs-var">E.callEndpoint</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;read&quot;</span></span><span> </span><span class="annot"><span class="annottext">ContractHandle
  (Last Value)
  ('R
     '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
        &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
        &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
        &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
        &quot;read&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
        &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
        &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
        &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
  Text
</span><a href="#local-6989586621679284417"><span class="hs-identifier hs-var">w2</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span>    </span><span class="annot"><span class="annottext">Eff
  '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
    LogMsg String, Error EmulatorRuntimeError]
  Slot
-&gt; EmulatorTrace ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(Eff
   '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
     LogMsg String, Error EmulatorRuntimeError]
   Slot
 -&gt; EmulatorTrace ())
-&gt; Eff
     '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
       LogMsg String, Error EmulatorRuntimeError]
     Slot
-&gt; EmulatorTrace ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Natural
-&gt; Eff
     '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
       LogMsg String, Error EmulatorRuntimeError]
     Slot
forall (effs :: [* -&gt; *]).
Member Waiting effs =&gt;
Natural -&gt; Eff effs Slot
</span><span class="hs-identifier hs-var">E.waitNSlots</span></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">3</span></span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; EmulatorTrace ()
forall a (effs :: [* -&gt; *]).
Member (LogMsg a) effs =&gt;
a -&gt; Eff effs ()
</span><span class="hs-identifier hs-var">X.logInfo</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Wallet 1 writes a value to the oracle.&quot;</span></span><span>
</span><span id="line-145"></span><span>    </span><span class="annot"><span class="annottext">ContractHandle
  (Last Oracle)
  ('R
     '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
        &quot;delete&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
        &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
        &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
        &quot;read&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
        &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
        &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
        &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address),
        &quot;write&quot; ':-&gt; (EndpointValue Data, ActiveEndpoint)])
  Text
-&gt; Data -&gt; EmulatorTrace ()
forall (l :: Symbol) ep w (s :: Row *) e (effs :: [* -&gt; *]).
(ContractConstraints s, HasEndpoint l ep s,
 Member RunContract effs) =&gt;
ContractHandle w s e -&gt; ep -&gt; Eff effs ()
</span><span class="hs-identifier hs-var">E.callEndpoint</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;write&quot;</span></span><span> </span><span class="annot"><span class="annottext">ContractHandle
  (Last Oracle)
  ('R
     '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
        &quot;delete&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
        &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
        &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
        &quot;read&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
        &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
        &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
        &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address),
        &quot;write&quot; ':-&gt; (EndpointValue Data, ActiveEndpoint)])
  Text
</span><a href="#local-6989586621679284423"><span class="hs-identifier hs-var">w1</span></a></span><span> </span><span class="annot"><span class="annottext">(Data -&gt; EmulatorTrace ()) -&gt; Data -&gt; EmulatorTrace ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Data
</span><span class="hs-identifier hs-var">I</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1_500</span></span><span>
</span><span id="line-146"></span><span>    </span><span class="annot"><span class="annottext">Eff
  '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
    LogMsg String, Error EmulatorRuntimeError]
  Slot
-&gt; EmulatorTrace ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(Eff
   '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
     LogMsg String, Error EmulatorRuntimeError]
   Slot
 -&gt; EmulatorTrace ())
-&gt; Eff
     '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
       LogMsg String, Error EmulatorRuntimeError]
     Slot
-&gt; EmulatorTrace ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Natural
-&gt; Eff
     '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
       LogMsg String, Error EmulatorRuntimeError]
     Slot
forall (effs :: [* -&gt; *]).
Member Waiting effs =&gt;
Natural -&gt; Eff effs Slot
</span><span class="hs-identifier hs-var">E.waitNSlots</span></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">3</span></span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; EmulatorTrace ()
forall a (effs :: [* -&gt; *]).
Member (LogMsg a) effs =&gt;
a -&gt; Eff effs ()
</span><span class="hs-identifier hs-var">X.logInfo</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Wallet 2 read the oracle.&quot;</span></span><span>
</span><span id="line-149"></span><span>    </span><span class="annot"><span class="annottext">ContractHandle
  (Last Value)
  ('R
     '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
        &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
        &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
        &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
        &quot;read&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
        &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
        &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
        &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
  Text
-&gt; () -&gt; EmulatorTrace ()
forall (l :: Symbol) ep w (s :: Row *) e (effs :: [* -&gt; *]).
(ContractConstraints s, HasEndpoint l ep s,
 Member RunContract effs) =&gt;
ContractHandle w s e -&gt; ep -&gt; Eff effs ()
</span><span class="hs-identifier hs-var">E.callEndpoint</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;read&quot;</span></span><span> </span><span class="annot"><span class="annottext">ContractHandle
  (Last Value)
  ('R
     '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
        &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
        &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
        &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
        &quot;read&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
        &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
        &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
        &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
  Text
</span><a href="#local-6989586621679284417"><span class="hs-identifier hs-var">w2</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span>    </span><span class="annot"><span class="annottext">Eff
  '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
    LogMsg String, Error EmulatorRuntimeError]
  Slot
-&gt; EmulatorTrace ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(Eff
   '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
     LogMsg String, Error EmulatorRuntimeError]
   Slot
 -&gt; EmulatorTrace ())
-&gt; Eff
     '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
       LogMsg String, Error EmulatorRuntimeError]
     Slot
-&gt; EmulatorTrace ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Natural
-&gt; Eff
     '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
       LogMsg String, Error EmulatorRuntimeError]
     Slot
forall (effs :: [* -&gt; *]).
Member Waiting effs =&gt;
Natural -&gt; Eff effs Slot
</span><span class="hs-identifier hs-var">E.waitNSlots</span></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">3</span></span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; EmulatorTrace ()
forall a (effs :: [* -&gt; *]).
Member (LogMsg a) effs =&gt;
a -&gt; Eff effs ()
</span><span class="hs-identifier hs-var">X.logInfo</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Wallet 3 doesn't have sufficient fee token to read the oracle at all.&quot;</span></span><span>
</span><span id="line-153"></span><span>    </span><span id="local-6989586621679284416"><span class="annot"><span class="annottext">ContractHandle
  (Last Value)
  ('R
     '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
        &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
        &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
        &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
        &quot;read&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
        &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
        &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
        &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
  Text
</span><a href="#local-6989586621679284416"><span class="hs-identifier hs-var">w3</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Wallet
-&gt; Contract
     (Last Value)
     ('R
        '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
           &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
           &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
           &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
           &quot;read&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
           &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
           &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
           &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
     Text
     ()
-&gt; Eff
     '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
       LogMsg String, Error EmulatorRuntimeError]
     (ContractHandle
        (Last Value)
        ('R
           '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
              &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
              &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
              &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
              &quot;read&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
              &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
              &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
              &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
              &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
        Text)
forall w (s :: Row *) e (effs :: [* -&gt; *]).
(HasBlockchainActions s, ContractConstraints s, Show e, ToJSON e,
 FromJSON e, ToJSON w, Member RunContract effs, Monoid w) =&gt;
Wallet -&gt; Contract w s e () -&gt; Eff effs (ContractHandle w s e)
</span><span class="hs-identifier hs-var">E.activateContractWallet</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Wallet
</span><span class="hs-identifier hs-var">Wallet</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">3</span></span><span class="hs-special">)</span><span> </span><span>
</span><span id="line-154"></span><span>       </span><span class="annot"><span class="annottext">(Contract
   (Last Value)
   ('R
      '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
         &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
         &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
         &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
         &quot;read&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
         &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
         &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
         &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
         &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
   Text
   ()
 -&gt; Eff
      '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
        LogMsg String, Error EmulatorRuntimeError]
      (ContractHandle
         (Last Value)
         ('R
            '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
               &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
               &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
               &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
               &quot;read&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
               &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
               &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
               &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
               &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
         Text))
-&gt; Contract
     (Last Value)
     ('R
        '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
           &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
           &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
           &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
           &quot;read&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
           &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
           &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
           &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
           &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
     Text
     ()
-&gt; Eff
     '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
       LogMsg String, Error EmulatorRuntimeError]
     (ContractHandle
        (Last Value)
        ('R
           '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
              &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
              &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
              &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
              &quot;read&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
              &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
              &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
              &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
              &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
        Text)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>  </span><span class="annot"><span class="annottext">Oracle -&gt; Contract (Last Value) ClientSchema Text ()
</span><a href="Mantis.Oracle.Client.html#runOracleClient"><span class="hs-identifier hs-var">runOracleClient</span></a></span><span> </span><span class="annot"><span class="annottext">Oracle
</span><a href="#local-6989586621679284422"><span class="hs-identifier hs-var">oracle</span></a></span><span>
</span><span id="line-155"></span><span>    </span><span class="annot"><span class="annottext">Eff
  '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
    LogMsg String, Error EmulatorRuntimeError]
  Slot
-&gt; EmulatorTrace ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(Eff
   '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
     LogMsg String, Error EmulatorRuntimeError]
   Slot
 -&gt; EmulatorTrace ())
-&gt; Eff
     '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
       LogMsg String, Error EmulatorRuntimeError]
     Slot
-&gt; EmulatorTrace ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Natural
-&gt; Eff
     '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
       LogMsg String, Error EmulatorRuntimeError]
     Slot
forall (effs :: [* -&gt; *]).
Member Waiting effs =&gt;
Natural -&gt; Eff effs Slot
</span><span class="hs-identifier hs-var">E.waitNSlots</span></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">3</span></span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; EmulatorTrace ()
forall a (effs :: [* -&gt; *]).
Member (LogMsg a) effs =&gt;
a -&gt; Eff effs ()
</span><span class="hs-identifier hs-var">X.logInfo</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Wallet 3 tries to read the oracle, even though it has insufficient fee tokens.&quot;</span></span><span>
</span><span id="line-158"></span><span>    </span><span class="annot"><span class="annottext">ContractHandle
  (Last Value)
  ('R
     '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
        &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
        &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
        &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
        &quot;read&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
        &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
        &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
        &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
  Text
-&gt; () -&gt; EmulatorTrace ()
forall (l :: Symbol) ep w (s :: Row *) e (effs :: [* -&gt; *]).
(ContractConstraints s, HasEndpoint l ep s,
 Member RunContract effs) =&gt;
ContractHandle w s e -&gt; ep -&gt; Eff effs ()
</span><span class="hs-identifier hs-var">E.callEndpoint</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;read&quot;</span></span><span> </span><span class="annot"><span class="annottext">ContractHandle
  (Last Value)
  ('R
     '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
        &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
        &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
        &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
        &quot;read&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
        &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
        &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
        &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
  Text
</span><a href="#local-6989586621679284416"><span class="hs-identifier hs-var">w3</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span>    </span><span class="annot"><span class="annottext">Eff
  '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
    LogMsg String, Error EmulatorRuntimeError]
  Slot
-&gt; EmulatorTrace ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(Eff
   '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
     LogMsg String, Error EmulatorRuntimeError]
   Slot
 -&gt; EmulatorTrace ())
-&gt; Eff
     '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
       LogMsg String, Error EmulatorRuntimeError]
     Slot
-&gt; EmulatorTrace ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Natural
-&gt; Eff
     '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
       LogMsg String, Error EmulatorRuntimeError]
     Slot
forall (effs :: [* -&gt; *]).
Member Waiting effs =&gt;
Natural -&gt; Eff effs Slot
</span><span class="hs-identifier hs-var">E.waitNSlots</span></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">3</span></span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; EmulatorTrace ()
forall a (effs :: [* -&gt; *]).
Member (LogMsg a) effs =&gt;
a -&gt; Eff effs ()
</span><span class="hs-identifier hs-var">X.logInfo</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Wallet 1 updates the value of the oracle.&quot;</span></span><span>
</span><span id="line-162"></span><span>    </span><span class="annot"><span class="annottext">ContractHandle
  (Last Oracle)
  ('R
     '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
        &quot;delete&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
        &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
        &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
        &quot;read&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
        &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
        &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
        &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address),
        &quot;write&quot; ':-&gt; (EndpointValue Data, ActiveEndpoint)])
  Text
-&gt; Data -&gt; EmulatorTrace ()
forall (l :: Symbol) ep w (s :: Row *) e (effs :: [* -&gt; *]).
(ContractConstraints s, HasEndpoint l ep s,
 Member RunContract effs) =&gt;
ContractHandle w s e -&gt; ep -&gt; Eff effs ()
</span><span class="hs-identifier hs-var">E.callEndpoint</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;write&quot;</span></span><span> </span><span class="annot"><span class="annottext">ContractHandle
  (Last Oracle)
  ('R
     '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
        &quot;delete&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
        &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
        &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
        &quot;read&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
        &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
        &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
        &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address),
        &quot;write&quot; ':-&gt; (EndpointValue Data, ActiveEndpoint)])
  Text
</span><a href="#local-6989586621679284423"><span class="hs-identifier hs-var">w1</span></a></span><span> </span><span class="annot"><span class="annottext">(Data -&gt; EmulatorTrace ()) -&gt; Data -&gt; EmulatorTrace ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Data
</span><span class="hs-identifier hs-var">I</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">2_500</span></span><span>
</span><span id="line-163"></span><span>    </span><span class="annot"><span class="annottext">Eff
  '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
    LogMsg String, Error EmulatorRuntimeError]
  Slot
-&gt; EmulatorTrace ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(Eff
   '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
     LogMsg String, Error EmulatorRuntimeError]
   Slot
 -&gt; EmulatorTrace ())
-&gt; Eff
     '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
       LogMsg String, Error EmulatorRuntimeError]
     Slot
-&gt; EmulatorTrace ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Natural
-&gt; Eff
     '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
       LogMsg String, Error EmulatorRuntimeError]
     Slot
forall (effs :: [* -&gt; *]).
Member Waiting effs =&gt;
Natural -&gt; Eff effs Slot
</span><span class="hs-identifier hs-var">E.waitNSlots</span></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">3</span></span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; EmulatorTrace ()
forall a (effs :: [* -&gt; *]).
Member (LogMsg a) effs =&gt;
a -&gt; Eff effs ()
</span><span class="hs-identifier hs-var">X.logInfo</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Wallet 2 reads the oracle a second time.&quot;</span></span><span>
</span><span id="line-166"></span><span>    </span><span class="annot"><span class="annottext">ContractHandle
  (Last Value)
  ('R
     '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
        &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
        &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
        &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
        &quot;read&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
        &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
        &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
        &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
  Text
-&gt; () -&gt; EmulatorTrace ()
forall (l :: Symbol) ep w (s :: Row *) e (effs :: [* -&gt; *]).
(ContractConstraints s, HasEndpoint l ep s,
 Member RunContract effs) =&gt;
ContractHandle w s e -&gt; ep -&gt; Eff effs ()
</span><span class="hs-identifier hs-var">E.callEndpoint</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;read&quot;</span></span><span> </span><span class="annot"><span class="annottext">ContractHandle
  (Last Value)
  ('R
     '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
        &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
        &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
        &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
        &quot;read&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
        &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
        &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
        &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
  Text
</span><a href="#local-6989586621679284417"><span class="hs-identifier hs-var">w2</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span>    </span><span class="annot"><span class="annottext">Eff
  '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
    LogMsg String, Error EmulatorRuntimeError]
  Slot
-&gt; EmulatorTrace ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(Eff
   '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
     LogMsg String, Error EmulatorRuntimeError]
   Slot
 -&gt; EmulatorTrace ())
-&gt; Eff
     '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
       LogMsg String, Error EmulatorRuntimeError]
     Slot
-&gt; EmulatorTrace ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Natural
-&gt; Eff
     '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
       LogMsg String, Error EmulatorRuntimeError]
     Slot
forall (effs :: [* -&gt; *]).
Member Waiting effs =&gt;
Natural -&gt; Eff effs Slot
</span><span class="hs-identifier hs-var">E.waitNSlots</span></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">3</span></span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; EmulatorTrace ()
forall a (effs :: [* -&gt; *]).
Member (LogMsg a) effs =&gt;
a -&gt; Eff effs ()
</span><span class="hs-identifier hs-var">X.logInfo</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Wallet 1 deletes the oracle.&quot;</span></span><span>
</span><span id="line-170"></span><span>    </span><span class="annot"><span class="annottext">ContractHandle
  (Last Oracle)
  ('R
     '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
        &quot;delete&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
        &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
        &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
        &quot;read&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
        &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
        &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
        &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address),
        &quot;write&quot; ':-&gt; (EndpointValue Data, ActiveEndpoint)])
  Text
-&gt; () -&gt; EmulatorTrace ()
forall (l :: Symbol) ep w (s :: Row *) e (effs :: [* -&gt; *]).
(ContractConstraints s, HasEndpoint l ep s,
 Member RunContract effs) =&gt;
ContractHandle w s e -&gt; ep -&gt; Eff effs ()
</span><span class="hs-identifier hs-var">E.callEndpoint</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;delete&quot;</span></span><span> </span><span class="annot"><span class="annottext">ContractHandle
  (Last Oracle)
  ('R
     '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
        &quot;delete&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
        &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
        &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
        &quot;read&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
        &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
        &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
        &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address),
        &quot;write&quot; ':-&gt; (EndpointValue Data, ActiveEndpoint)])
  Text
</span><a href="#local-6989586621679284423"><span class="hs-identifier hs-var">w1</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-171"></span><span>    </span><span class="annot"><span class="annottext">Eff
  '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
    LogMsg String, Error EmulatorRuntimeError]
  Slot
-&gt; EmulatorTrace ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(Eff
   '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
     LogMsg String, Error EmulatorRuntimeError]
   Slot
 -&gt; EmulatorTrace ())
-&gt; Eff
     '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
       LogMsg String, Error EmulatorRuntimeError]
     Slot
-&gt; EmulatorTrace ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Natural
-&gt; Eff
     '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
       LogMsg String, Error EmulatorRuntimeError]
     Slot
forall (effs :: [* -&gt; *]).
Member Waiting effs =&gt;
Natural -&gt; Eff effs Slot
</span><span class="hs-identifier hs-var">E.waitNSlots</span></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">3</span></span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; EmulatorTrace ()
forall a (effs :: [* -&gt; *]).
Member (LogMsg a) effs =&gt;
a -&gt; Eff effs ()
</span><span class="hs-identifier hs-var">X.logInfo</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Wallet 2 tries to read the oracle after its deletion.&quot;</span></span><span>
</span><span id="line-174"></span><span>    </span><span class="annot"><span class="annottext">ContractHandle
  (Last Value)
  ('R
     '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
        &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
        &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
        &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
        &quot;read&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
        &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
        &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
        &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
  Text
-&gt; () -&gt; EmulatorTrace ()
forall (l :: Symbol) ep w (s :: Row *) e (effs :: [* -&gt; *]).
(ContractConstraints s, HasEndpoint l ep s,
 Member RunContract effs) =&gt;
ContractHandle w s e -&gt; ep -&gt; Eff effs ()
</span><span class="hs-identifier hs-var">E.callEndpoint</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;read&quot;</span></span><span> </span><span class="annot"><span class="annottext">ContractHandle
  (Last Value)
  ('R
     '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
        &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
        &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
        &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
        &quot;read&quot; ':-&gt; (EndpointValue (), ActiveEndpoint),
        &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
        &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
        &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
        &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
  Text
</span><a href="#local-6989586621679284417"><span class="hs-identifier hs-var">w2</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-175"></span><span>    </span><span class="annot"><span class="annottext">Eff
  '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
    LogMsg String, Error EmulatorRuntimeError]
  Slot
-&gt; EmulatorTrace ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(Eff
   '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
     LogMsg String, Error EmulatorRuntimeError]
   Slot
 -&gt; EmulatorTrace ())
-&gt; Eff
     '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
       LogMsg String, Error EmulatorRuntimeError]
     Slot
-&gt; EmulatorTrace ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Natural
-&gt; Eff
     '[RunContract, Waiting, EmulatorControl, EmulatedWalletAPI,
       LogMsg String, Error EmulatorRuntimeError]
     Slot
forall (effs :: [* -&gt; *]).
Member Waiting effs =&gt;
Natural -&gt; Eff effs Slot
</span><span class="hs-identifier hs-var">E.waitNSlots</span></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">3</span></span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span class="hs-comment">-- | Log the oracle's current data.</span><span>
</span><span id="line-179"></span><span class="annot"><a href="Mantis.Oracle.Simulate.html#peekDatum"><span class="hs-identifier hs-type">peekDatum</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Mantis.Oracle.Types.html#Oracle"><span class="hs-identifier hs-type">Oracle</span></a></span><span>                                    </span><span class="hs-comment">-- ^ The oracle.</span><span>
</span><span id="line-180"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.Contract</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.BlockchainActions</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Action for logging the oracle's data.</span><span>
</span><span id="line-181"></span><span id="peekDatum"><span class="annot"><span class="annottext">peekDatum :: Oracle -&gt; Contract () BlockchainActions Text ()
</span><a href="Mantis.Oracle.Simulate.html#peekDatum"><span class="hs-identifier hs-var hs-var">peekDatum</span></a></span></span><span> </span><span id="local-6989586621679284415"><span class="annot"><span class="annottext">Oracle
</span><a href="#local-6989586621679284415"><span class="hs-identifier hs-var">oracle</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-182"></span><span>  </span><span class="hs-keyword">do</span><span>
</span><span id="line-183"></span><span>    </span><span id="local-6989586621679284414"><span class="annot"><span class="annottext">Maybe (TxOutRef, TxOutTx, Data)
</span><a href="#local-6989586621679284414"><span class="hs-identifier hs-var">inst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Oracle
-&gt; Contract
     ()
     ('R
        '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
           &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
           &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
           &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
           &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
           &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
           &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
           &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
     Text
     (Maybe (TxOutRef, TxOutTx, Data))
forall (s :: Row *) w.
HasBlockchainActions s =&gt;
Oracle -&gt; Contract w s Text (Maybe (TxOutRef, TxOutTx, Data))
</span><a href="Mantis.Oracle.html#findOracle"><span class="hs-identifier hs-var">findOracle</span></a></span><span> </span><span class="annot"><span class="annottext">Oracle
</span><a href="#local-6989586621679284415"><span class="hs-identifier hs-var">oracle</span></a></span><span>
</span><span id="line-184"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (TxOutRef, TxOutTx, Data)
</span><a href="#local-6989586621679284414"><span class="hs-identifier hs-var">inst</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-185"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOutRef
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxOutTx
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">I</span></span><span> </span><span id="local-6989586621679284413"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679284413"><span class="hs-identifier hs-var">datum</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
-&gt; Contract
     ()
     ('R
        '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
           &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
           &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
           &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
           &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
           &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
           &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
           &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
     Text
     ()
forall a w (s :: Row *) e. ToJSON a =&gt; a -&gt; Contract w s e ()
</span><span class="hs-identifier hs-var">C.logInfo</span></span><span> </span><span class="annot"><span class="annottext">(String
 -&gt; Contract
      ()
      ('R
         '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
            &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
            &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
            &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
            &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
            &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
            &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
            &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
      Text
      ())
-&gt; String
-&gt; Contract
     ()
     ('R
        '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
           &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
           &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
           &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
           &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
           &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
           &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
           &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
     Text
     ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Oracle value: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679284413"><span class="hs-identifier hs-var">datum</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.&quot;</span></span><span>
</span><span id="line-186"></span><span>      </span><span class="annot"><span class="annottext">Maybe (TxOutRef, TxOutTx, Data)
</span><span class="hs-identifier">_</span></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">()
-&gt; Contract
     ()
     ('R
        '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
           &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
           &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
           &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
           &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
           &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
           &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
           &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
     Text
     ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-187"></span><span>    </span><span class="annot"><span class="annottext">Integer
-&gt; Contract
     ()
     ('R
        '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
           &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
           &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
           &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
           &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
           &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
           &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
           &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
     Text
     Slot
forall w (s :: Row *) e.
(HasAwaitSlot s, AsContractError e) =&gt;
Integer -&gt; Contract w s e Slot
</span><span class="hs-identifier hs-var">C.waitNSlots</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span>
</span><span id="line-188"></span><span>      </span><span class="annot"><span class="annottext">Contract
  ()
  ('R
     '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
        &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
        &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
        &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
        &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
        &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
        &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
        &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
  Text
  Slot
-&gt; Contract
     ()
     ('R
        '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
           &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
           &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
           &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
           &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
           &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
           &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
           &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
     Text
     ()
-&gt; Contract
     ()
     ('R
        '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
           &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
           &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
           &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
           &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
           &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
           &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
           &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
     Text
     ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Oracle -&gt; Contract () BlockchainActions Text ()
</span><a href="Mantis.Oracle.Simulate.html#peekDatum"><span class="hs-identifier hs-var">peekDatum</span></a></span><span> </span><span class="annot"><span class="annottext">Oracle
</span><a href="#local-6989586621679284415"><span class="hs-identifier hs-var">oracle</span></a></span><span>
</span><span id="line-189"></span><span>
</span><span id="line-190"></span><span>
</span><span id="line-191"></span><span class="hs-comment">-- | Log the funds in a wallet or in the oracle script.</span><span>
</span><span id="line-192"></span><span class="annot"><a href="Mantis.Oracle.Simulate.html#peekFunds"><span class="hs-identifier hs-type">peekFunds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Mantis.Oracle.Types.html#Oracle"><span class="hs-identifier hs-type">Oracle</span></a></span><span>                                              </span><span class="hs-comment">-- ^ The oracle.</span><span>
</span><span id="line-193"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span>                                       </span><span class="hs-comment">-- ^ The wallet number, or `Nothing` for the oracle script.</span><span>
</span><span id="line-194"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.Contract</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Last</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.BlockchainActions</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Action for logging the funds.</span><span>
</span><span id="line-195"></span><span id="peekFunds"><span class="annot"><span class="annottext">peekFunds :: Oracle
-&gt; Maybe Integer -&gt; Contract (Last Value) BlockchainActions Text ()
</span><a href="Mantis.Oracle.Simulate.html#peekFunds"><span class="hs-identifier hs-var hs-var">peekFunds</span></a></span></span><span> </span><span id="local-6989586621679284411"><span class="annot"><span class="annottext">oracle :: Oracle
</span><a href="#local-6989586621679284411"><span class="hs-identifier hs-var">oracle</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Mantis.Oracle.Types.html#Oracle"><span class="hs-identifier hs-type">Oracle</span></a></span><span class="hs-special">{</span><span id="local-6989586621679284407"><span id="local-6989586621679284408"><span id="local-6989586621679284409"><span class="annot"><span class="annottext">AssetClass
Value
requiredFee :: Oracle -&gt; Value
datumToken :: Oracle -&gt; AssetClass
controlToken :: Oracle -&gt; AssetClass
requiredFee :: Value
datumToken :: AssetClass
controlToken :: AssetClass
</span><a href="Mantis.Oracle.Types.html#requiredFee"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679284403"><span class="annot"><span class="annottext">Maybe Integer
</span><a href="#local-6989586621679284403"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-196"></span><span>  </span><span class="hs-keyword">do</span><span>
</span><span id="line-197"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-198"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">(</span><span id="local-6989586621679284402"><span class="annot"><span class="annottext">CurrencySymbol
</span><a href="#local-6989586621679284402"><span class="hs-identifier hs-var">currency</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679284401"><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621679284401"><span class="hs-identifier hs-var">feeName</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; [(CurrencySymbol, TokenName, Integer)]
</span><span class="hs-identifier hs-var">flattenValue</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679284407"><span class="hs-identifier hs-var">requiredFee</span></a></span><span>
</span><span id="line-199"></span><span>      </span><span id="local-6989586621679284400"><span class="annot"><span class="annottext">feeToken :: AssetClass
</span><a href="#local-6989586621679284400"><span class="hs-identifier hs-var hs-var">feeToken</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CurrencySymbol -&gt; TokenName -&gt; AssetClass
</span><span class="hs-identifier hs-var">assetClass</span></span><span> </span><span class="annot"><span class="annottext">CurrencySymbol
</span><a href="#local-6989586621679284402"><span class="hs-identifier hs-var">currency</span></a></span><span> </span><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621679284401"><span class="hs-identifier hs-var">feeName</span></a></span><span>
</span><span id="line-200"></span><span>      </span><span class="annot"><a href="#local-6989586621679284399"><span class="hs-identifier hs-type">funds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.Contract</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Last</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.BlockchainActions</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span>
</span><span id="line-201"></span><span>      </span><span id="local-6989586621679284399"><span class="annot"><span class="annottext">funds :: Contract (Last Value) BlockchainActions Text Value
</span><a href="#local-6989586621679284399"><span class="hs-identifier hs-var hs-var">funds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-202"></span><span>        </span><span class="hs-keyword">do</span><span>
</span><span id="line-203"></span><span>          </span><span id="local-6989586621679284398"><span class="annot"><span class="annottext">PubKey
</span><a href="#local-6989586621679284398"><span class="hs-identifier hs-var">owner</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Contract
  (Last Value)
  ('R
     '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
        &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
        &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
        &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
        &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
        &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
        &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
        &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
  Text
  PubKey
forall w (s :: Row *) e.
(AsContractError e, HasOwnPubKey s) =&gt;
Contract w s e PubKey
</span><span class="hs-identifier hs-var">C.ownPubKey</span></span><span>
</span><span id="line-204"></span><span>          </span><span id="local-6989586621679284397"><span class="annot"><span class="annottext">UtxoMap
</span><a href="#local-6989586621679284397"><span class="hs-identifier hs-var">utxos</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Address
-&gt; Contract
     (Last Value)
     ('R
        '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
           &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
           &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
           &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
           &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
           &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
           &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
           &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
     Text
     UtxoMap
forall w (s :: Row *) e.
(AsContractError e, HasUtxoAt s) =&gt;
Address -&gt; Contract w s e UtxoMap
</span><span class="hs-identifier hs-var">C.utxoAt</span></span><span> </span><span class="annot"><span class="annottext">(Address
 -&gt; Contract
      (Last Value)
      ('R
         '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
            &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
            &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
            &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
            &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
            &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
            &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
            &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
      Text
      UtxoMap)
-&gt; Address
-&gt; Contract
     (Last Value)
     ('R
        '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
           &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
           &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
           &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
           &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
           &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
           &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
           &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
     Text
     UtxoMap
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Address -&gt; (Integer -&gt; Address) -&gt; Maybe Integer -&gt; Address
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Oracle -&gt; Address
</span><a href="Mantis.Oracle.html#oracleAddress"><span class="hs-identifier hs-var">oracleAddress</span></a></span><span> </span><span class="annot"><span class="annottext">Oracle
</span><a href="#local-6989586621679284411"><span class="hs-identifier hs-var">oracle</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Address -&gt; Integer -&gt; Address
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(Address -&gt; Integer -&gt; Address) -&gt; Address -&gt; Integer -&gt; Address
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PubKey -&gt; Address
</span><span class="hs-identifier hs-var">pubKeyAddress</span></span><span> </span><span class="annot"><span class="annottext">PubKey
</span><a href="#local-6989586621679284398"><span class="hs-identifier hs-var">owner</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Integer
</span><a href="#local-6989586621679284403"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-205"></span><span>          </span><span class="hs-keyword">let</span><span>
</span><span id="line-206"></span><span>            </span><span id="local-6989586621679284394"><span class="annot"><span class="annottext">value :: Value
</span><a href="#local-6989586621679284394"><span class="hs-identifier hs-var hs-var">value</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Value] -&gt; Value
forall (t :: * -&gt; *) a. (Foldable t, AdditiveMonoid a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">sum</span></span><span> </span><span class="annot"><span class="annottext">([Value] -&gt; Value) -&gt; [Value] -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TxOut -&gt; Value
</span><span class="hs-identifier hs-var hs-var">txOutValue</span></span><span> </span><span class="annot"><span class="annottext">(TxOut -&gt; Value) -&gt; (TxOutTx -&gt; TxOut) -&gt; TxOutTx -&gt; Value
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TxOutTx -&gt; TxOut
</span><span class="hs-identifier hs-var hs-var">txOutTxOut</span></span><span> </span><span class="annot"><span class="annottext">(TxOutTx -&gt; Value) -&gt; [TxOutTx] -&gt; [Value]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">UtxoMap -&gt; [TxOutTx]
forall k a. Map k a -&gt; [a]
</span><span class="hs-identifier hs-var">M.elems</span></span><span> </span><span class="annot"><span class="annottext">UtxoMap
</span><a href="#local-6989586621679284397"><span class="hs-identifier hs-var">utxos</span></a></span><span>
</span><span id="line-207"></span><span>          </span><span class="annot"><span class="annottext">String
-&gt; Contract
     (Last Value)
     ('R
        '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
           &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
           &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
           &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
           &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
           &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
           &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
           &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
     Text
     ()
forall a w (s :: Row *) e. ToJSON a =&gt; a -&gt; Contract w s e ()
</span><span class="hs-identifier hs-var">C.logInfo</span></span><span>
</span><span id="line-208"></span><span>            </span><span class="annot"><span class="annottext">(String
 -&gt; Contract
      (Last Value)
      ('R
         '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
            &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
            &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
            &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
            &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
            &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
            &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
            &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
      Text
      ())
-&gt; String
-&gt; Contract
     (Last Value)
     ('R
        '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
           &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
           &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
           &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
           &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
           &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
           &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
           &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
     Text
     ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; (Integer -&gt; String) -&gt; Maybe Integer -&gt; String
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Funds in Script&quot;</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Funds in Wallet &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(String -&gt; String) -&gt; (Integer -&gt; String) -&gt; Integer -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Integer
</span><a href="#local-6989586621679284403"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-209"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ada -&gt; Integer
</span><span class="hs-identifier hs-var hs-var">getLovelace</span></span><span> </span><span class="annot"><span class="annottext">(Ada -&gt; Integer) -&gt; Ada -&gt; Integer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Ada
</span><span class="hs-identifier hs-var">fromValue</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679284394"><span class="hs-identifier hs-var">value</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; Lovelace&quot;</span></span><span>
</span><span id="line-210"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;, &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; AssetClass -&gt; Integer
</span><span class="hs-identifier hs-var">assetClassValueOf</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679284394"><span class="hs-identifier hs-var">value</span></a></span><span> </span><span class="annot"><span class="annottext">AssetClass
</span><a href="#local-6989586621679284409"><span class="hs-identifier hs-var">controlToken</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">TokenName -&gt; String
</span><span class="hs-identifier hs-var">toString</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CurrencySymbol, TokenName) -&gt; TokenName
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((CurrencySymbol, TokenName) -&gt; TokenName)
-&gt; (CurrencySymbol, TokenName) -&gt; TokenName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AssetClass -&gt; (CurrencySymbol, TokenName)
</span><span class="hs-identifier hs-var hs-var">unAssetClass</span></span><span> </span><span class="annot"><span class="annottext">AssetClass
</span><a href="#local-6989586621679284409"><span class="hs-identifier hs-var">controlToken</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;, &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; AssetClass -&gt; Integer
</span><span class="hs-identifier hs-var">assetClassValueOf</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679284394"><span class="hs-identifier hs-var">value</span></a></span><span> </span><span class="annot"><span class="annottext">AssetClass
</span><a href="#local-6989586621679284408"><span class="hs-identifier hs-var">datumToken</span></a></span><span>  </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">TokenName -&gt; String
</span><span class="hs-identifier hs-var">toString</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CurrencySymbol, TokenName) -&gt; TokenName
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((CurrencySymbol, TokenName) -&gt; TokenName)
-&gt; (CurrencySymbol, TokenName) -&gt; TokenName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AssetClass -&gt; (CurrencySymbol, TokenName)
</span><span class="hs-identifier hs-var hs-var">unAssetClass</span></span><span> </span><span class="annot"><span class="annottext">AssetClass
</span><a href="#local-6989586621679284408"><span class="hs-identifier hs-var">datumToken</span></a></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-212"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;, &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; AssetClass -&gt; Integer
</span><span class="hs-identifier hs-var">assetClassValueOf</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679284394"><span class="hs-identifier hs-var">value</span></a></span><span> </span><span class="annot"><span class="annottext">AssetClass
</span><a href="#local-6989586621679284400"><span class="hs-identifier hs-var">feeToken</span></a></span><span>    </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">TokenName -&gt; String
</span><span class="hs-identifier hs-var">toString</span></span><span> </span><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621679284401"><span class="hs-identifier hs-var">feeName</span></a></span><span>
</span><span id="line-213"></span><span>          </span><span class="annot"><span class="annottext">Value
-&gt; Contract
     (Last Value)
     ('R
        '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
           &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
           &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
           &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
           &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
           &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
           &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
           &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
     Text
     Value
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679284394"><span class="hs-identifier hs-var">value</span></a></span><span>
</span><span id="line-214"></span><span>    </span><span class="annot"><span class="annottext">(Text
 -&gt; Contract
      (Last Value)
      ('R
         '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
            &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
            &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
            &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
            &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
            &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
            &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
            &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
      Text
      ())
-&gt; Contract
     (Last Value)
     ('R
        '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
           &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
           &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
           &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
           &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
           &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
           &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
           &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
     Text
     ()
-&gt; Contract
     (Last Value)
     ('R
        '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
           &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
           &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
           &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
           &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
           &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
           &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
           &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
     Text
     ()
forall w (s :: Row *) e e' a.
(e -&gt; Contract w s e' a) -&gt; Contract w s e a -&gt; Contract w s e' a
</span><span class="hs-identifier hs-var">C.handleError</span></span><span> </span><span class="annot"><span class="annottext">Text
-&gt; Contract
     (Last Value)
     ('R
        '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
           &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
           &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
           &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
           &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
           &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
           &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
           &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
     Text
     ()
forall a w (s :: Row *) e. ToJSON a =&gt; a -&gt; Contract w s e ()
</span><span class="hs-identifier hs-var">C.logError</span></span><span>
</span><span id="line-215"></span><span>      </span><span class="annot"><span class="annottext">(Contract
   (Last Value)
   ('R
      '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
         &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
         &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
         &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
         &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
         &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
         &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
         &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
   Text
   ()
 -&gt; Contract
      (Last Value)
      ('R
         '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
            &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
            &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
            &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
            &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
            &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
            &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
            &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
      Text
      ())
-&gt; Contract
     (Last Value)
     ('R
        '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
           &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
           &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
           &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
           &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
           &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
           &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
           &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
     Text
     ()
-&gt; Contract
     (Last Value)
     ('R
        '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
           &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
           &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
           &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
           &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
           &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
           &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
           &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
     Text
     ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Contract (Last Value) BlockchainActions Text Value
Contract
  (Last Value)
  ('R
     '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
        &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
        &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
        &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
        &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
        &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
        &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
        &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
  Text
  Value
</span><a href="#local-6989586621679284399"><span class="hs-identifier hs-var">funds</span></a></span><span> </span><span class="annot"><span class="annottext">Contract
  (Last Value)
  ('R
     '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
        &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
        &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
        &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
        &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
        &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
        &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
        &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
  Text
  Value
-&gt; (Value
    -&gt; Contract
         (Last Value)
         ('R
            '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
               &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
               &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
               &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
               &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
               &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
               &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
               &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
         Text
         ())
-&gt; Contract
     (Last Value)
     ('R
        '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
           &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
           &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
           &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
           &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
           &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
           &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
           &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
     Text
     ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Last Value
-&gt; Contract
     (Last Value)
     ('R
        '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
           &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
           &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
           &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
           &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
           &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
           &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
           &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
     Text
     ()
forall w (s :: Row *) e. w -&gt; Contract w s e ()
</span><span class="hs-identifier hs-var">C.tell</span></span><span> </span><span class="annot"><span class="annottext">(Last Value
 -&gt; Contract
      (Last Value)
      ('R
         '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
            &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
            &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
            &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
            &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
            &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
            &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
            &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
      Text
      ())
-&gt; (Value -&gt; Last Value)
-&gt; Value
-&gt; Contract
     (Last Value)
     ('R
        '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
           &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
           &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
           &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
           &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
           &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
           &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
           &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
     Text
     ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Maybe Value -&gt; Last Value
forall a. Maybe a -&gt; Last a
</span><span class="hs-identifier hs-var">Last</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Value -&gt; Last Value)
-&gt; (Value -&gt; Maybe Value) -&gt; Value -&gt; Last Value
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Maybe Value
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span>
</span><span id="line-216"></span><span>    </span><span class="annot"><span class="annottext">Contract
  (Last Value)
  ('R
     '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
        &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
        &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
        &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
        &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
        &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
        &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
        &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
  Text
  Slot
-&gt; Contract
     (Last Value)
     ('R
        '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
           &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
           &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
           &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
           &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
           &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
           &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
           &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
     Text
     ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(Contract
   (Last Value)
   ('R
      '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
         &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
         &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
         &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
         &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
         &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
         &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
         &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
   Text
   Slot
 -&gt; Contract
      (Last Value)
      ('R
         '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
            &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
            &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
            &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
            &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
            &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
            &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
            &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
      Text
      ())
-&gt; Contract
     (Last Value)
     ('R
        '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
           &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
           &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
           &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
           &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
           &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
           &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
           &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
     Text
     Slot
-&gt; Contract
     (Last Value)
     ('R
        '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
           &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
           &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
           &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
           &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
           &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
           &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
           &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
     Text
     ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Integer
-&gt; Contract
     (Last Value)
     ('R
        '[ &quot;address&quot; ':-&gt; (AddressChangeResponse, AddressChangeRequest),
           &quot;notify-instance&quot; ':-&gt; (Maybe NotificationError, Notification),
           &quot;own-instance-id&quot; ':-&gt; (ContractInstanceId, OwnIdRequest),
           &quot;own-pubkey&quot; ':-&gt; (PubKey, OwnPubKeyRequest),
           &quot;slot&quot; ':-&gt; (Slot, WaitingForSlot),
           &quot;tx&quot; ':-&gt; (WriteTxResponse, UnbalancedTx),
           &quot;tx-confirmation&quot; ':-&gt; (TxConfirmed, TxId),
           &quot;utxo-at&quot; ':-&gt; (UtxoAtAddress, Address)])
     Text
     Slot
forall w (s :: Row *) e.
(HasAwaitSlot s, AsContractError e) =&gt;
Integer -&gt; Contract w s e Slot
</span><span class="hs-identifier hs-var">C.waitNSlots</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span>
</span><span id="line-217"></span><span>    </span><span class="annot"><span class="annottext">Oracle
-&gt; Maybe Integer -&gt; Contract (Last Value) BlockchainActions Text ()
</span><a href="Mantis.Oracle.Simulate.html#peekFunds"><span class="hs-identifier hs-var">peekFunds</span></a></span><span> </span><span class="annot"><span class="annottext">Oracle
</span><a href="#local-6989586621679284411"><span class="hs-identifier hs-var">oracle</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Integer
</span><a href="#local-6989586621679284403"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-218"></span></pre></body></html>